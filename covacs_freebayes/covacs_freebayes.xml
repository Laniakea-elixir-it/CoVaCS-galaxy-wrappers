 <tool id="covacs_frebayes" name="covacs_freebayes" version="1.2.0">
  <description>freebayes, Bayesian genetic variant detector, wrapper for covacs</description>
  <macros>
  <import>covacs_macros.xml</import>
  <import>bed_macros.xml</import>
  </macros>
  <requirements>
	<requirement type="package" version="1.2.0" >freebayes</requirement>
  </requirements>
  <command>
    <![CDATA[

	
	
	
	freebayes
	
	   ##call chose genome from mutect2_indexes.loc and from history 
        #if $reference_source.reference_source_selector == "cached"
                -f $reference_source.ref_file.fields.path
        #end if
        #if $reference_source.reference_source_selector == "history" 
		-f $reference_source.ref_file_h
	#end if
	
	#if $input2
	-C $input2
	#end if
	
	#if $bed_source.bed_source_selector == "history" and $bed_source.bed_history
        -t  $bed_source.bed_history 
        #end if
        #if $bed_source.bed_source_selector == "cached"
        -t $bed_source.bed_cached.fields.path
        #end if

	$input1
	> $output
	

        && perl  $__tool_directory__/filter.fb.pl $output $output_filtered


	]]>
  </command>
  <inputs>
    <expand macro="reference_loc"/>
    <param format="bam" name="input1" label="bam file" type="data" optional="true" />
    <expand macro="bed_loc"/>
    <param name="input2" label="-C min-alternate-count" type="text" optional="true"/>
  </inputs>
  <outputs>
    <data format="vcf" name="output" label="${tool.name} on ${on_string}:vcf"/>
    <data format="vcf" name="output_filtered" label="freebayes filtered on ${on_string}" />
  </outputs>
  <help>
**options implemented in the wrapper**

-f --fasta-reference FILE
                   Use FILE as the reference sequence for analysis.
                   An index file (FILE.fai) will be created if none exists.
                   If neither --targets nor --region are specified, FreeBayes
                   will analyze every position in this reference.

-C --min-alternate-count N
                   Require at least this count of observations supporting
                   an alternate allele within a single individual in order
                   to evaluate the position.
-t --targets FILE
                   Limit analysis to targets listed in the BED-format FILE.

**the wrapper gives 2 output** 

-the normal output of freebayes

-the output filtered by the filter.fb.pl script implemented in the covacs pipeline

  </help>
  <citations>
        <citation type="doi">10.1186/s12864-018-4508-1</citation>
	<citation type="bibtex">
            @article{Tange2011a,
                title = {GNU Parallel - The Command-Line Power Tool},
                author = {O. Tange},
                address = {Frederiksberg, Denmark},
                journal = {;login: The USENIX Magazine},
                month = {Feb},
                number = {1},
                volume = {36},
                url = {http://www.gnu.org/s/parallel},
                year = {2011},
                pages = {42-47}
            }
	</citation>
	 <citation type="bibtex">
                @misc{1207.3907,
                    Author = {Erik Garrison},
                    Title = {Haplotype-based variant detection from short-read sequencing},
                    Year = {2012},
                    Eprint = {arXiv:1207.3907},
                    url = {http://arxiv.org/abs/1207.3907}
                }
         </citation>
  </citations>
</tool>

